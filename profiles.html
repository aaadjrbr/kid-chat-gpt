<!-- profiles.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kid Chat App - Profiles</title>
    <link rel="stylesheet" href="styles/profiles.css">
    <link href="https://fonts.googleapis.com/css2?family=Protest+Strike&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@100;300;400;500;700;800;900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Protest+Strike&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Add this above or below the existing content -->
    <div class="logout-container">
    <button id="logout-button">Logout</button>
    </div>

    <h2 class="title1">Who is there?</h2>
    <br/>
    <div id="profiles-container"></div>
    <div class="center-container">
        <div id="options-container"></div>
    </div>
    <br/>

    <!-- Toggle Button for Add New Profile Form -->
    <div class="add-user-btn-container">
        <button id="toggle-add-profile">‚ûï Add New Profile</button>
    </div>
    <br/>

    <!-- Add New Profile Form, initially hidden -->
    <form id="add-profile-form" style="display: none; text-align: center;">
        <input class="gradient-border" type="text" id="kid-name" placeholder="Kid's Name" required>
        <input class="gradient-border" type="number" id="kid-age" placeholder="Kid's Age" required>
        <div id="image-selection">
            <p class="modal-options">Choose an Image:</p>
            <div id="image-gallery">
                <!-- Images will be loaded here via JavaScript -->
            </div>
        </div>
        <br/>
        <button type="submit" class="toggle-add-profile2">‚ú® Add Profile</button>
    </form>

    <!-- Modal for editing a profile -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 class="modal-title">‚úèÔ∏è Edit Profile</h3>
            <input class="gradient-border" type="text" id="edit-kid-name" placeholder="Kid's Name">
            <input class="gradient-border" type="number" id="edit-kid-age" placeholder="Kid's Age">
            <div id="edit-image-selection">
                <p class="modal-options">Choose a New Image:</p>
                <div id="edit-image-gallery">
                    <!-- Images will be loaded here via JavaScript -->
                </div>
            </div>
            <br/>
            <button id="save-changes-button">üíæ Save</button>
            <button id="delete-profile-button">‚ùå Delete Profile</button>
        </div>
    </div>
    <br/><br/>
<div class="info-bottom">
    <a href="#"><p>Parents</p></a> | <a href="#"><p>About us</p></a>
</div>
    <br/>


    <script src="scripts/firebase-config.js" type="module"></script>
    <script type="module">
        import { loadProfiles, addProfile, viewChatHistory, startNewChat, setupImageGallery, deleteProfileHandler } from './scripts/profiles.js';
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
    
        window.viewChatHistory = viewChatHistory;
        window.startNewChat = startNewChat;
    
        document.addEventListener('DOMContentLoaded', () => {
            loadProfiles();
            setupImageGallery('image-gallery'); // Set up image gallery for adding a profile
            setupImageGallery('edit-image-gallery'); // Set up image gallery for editing a profile
    
            // Toggle Add Profile Form
            const toggleButton = document.getElementById('toggle-add-profile');
            const addProfileForm = document.getElementById('add-profile-form');
            toggleButton.addEventListener('click', () => {
                if (addProfileForm.classList.contains('fade-in')) {
                    addProfileForm.classList.remove('fade-in');
                    addProfileForm.classList.add('fade-out');
                    setTimeout(() => {
                        addProfileForm.style.display = 'none';
                    }, 500); // Match this with the CSS transition time
                } else {
                    addProfileForm.style.display = 'block';
                    setTimeout(() => {
                        addProfileForm.classList.remove('fade-out');
                        addProfileForm.classList.add('fade-in');
                    }, 10); // A tiny delay ensures the CSS transition is triggered
                }
            });
    
            // Logout button functionality
            const logoutButton = document.getElementById('logout-button');
            const auth = getAuth();
            logoutButton.addEventListener('click', () => {
                signOut(auth)
                    .then(() => {
                        // Redirect to a specific page after successful logout
                        window.location.href = 'index.html'; // Change to your desired page
                    })
                    .catch((error) => {
                        console.error("Error logging out:", error);
                    });
            });
        });
    
        // Handle form submission to add a new profile
        document.getElementById('add-profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const kidName = document.getElementById('kid-name').value;
            const kidAge = parseInt(document.getElementById('kid-age').value);
            const selectedImage = document.querySelector('#image-gallery .selected')?.dataset.image || 'default.webp';
            await addProfile(kidName, kidAge, selectedImage);
            document.getElementById('add-profile-form').reset();
            loadProfiles();
        });
    
        // Use deleteProfileHandler for handling profile deletion
        document.getElementById('delete-profile-button').addEventListener('click', deleteProfileHandler);
    </script>    
        
</body>
</html>
